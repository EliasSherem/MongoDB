var maori= new Mongo()
var video = new Mongo()

var dbmaori=maori.getDB("maori")
var dbvideo=video.getDB("video")

//Pregunta 1
//*****************************************************************************************************************************
//*****************************************************************************************************************************
 var pregunta1=dbmaori.worker_turnover_rates.aggregate({$addFields: {
             turnover_rate:{authority_worker:{$multiply:["$Maori_authority_worker_turnover_rate",0.5]},
             SME_worker:{$multiply:["$Maori_SME_worker_turnover_rate",0.5]},
            tourim_worker:{$multiply:["$Maori_tourism_worker_turnover_rate",0.5]}}
                    }
    },{$unset:["Maori_authority_worker_turnover_rate","Maori_SME_worker_turnover_rate","Maori_tourism_worker_turnover_rate"]},
    )
//*****************************************************************************************************************************
//*****************************************************************************************************************************



// Pregunta 2
//*****************************************************************************************************************************
//*****************************************************************************************************************************
var pregunta2=dbvideo.movieDetails.aggregate([{
        "$group" : {
            "_id" : "$year",
            "numFilmsThisYear" : {"$sum" : 1}
        },
        {
            "$match" : {"_id" : {$gte : 1960}}
        }
    ])
    
//*****************************************************************************************************************************
//*****************************************************************************************************************************




//Pregunta 3
//*****************************************************************************************************************************
//*****************************************************************************************************************************
var pregunta3=dbvideo.movieDetails.aggregate([
  {
    "$bucket": {
      "groupBy": "$runtime",
      "boundaries": [45, 100, 150, 200, Infinity],
      default: "null",
      output: {
          "count": {$sum: 1}
      }
    }
  }
])
//*****************************************************************************************************************************
//*****************************************************************************************************************************



//Pregunta 4
//*****************************************************************************************************************************
//*****************************************************************************************************************************
var pregunta4=dbvideo.movieDetails.aggregate( [
  {
    $facet: {
      "moviesByYear": [
        {
           $bucket: {
            groupBy: "$year",
            boundaries: [1880,1900,1920,1940,1960,1980,2000],
            default: "Other",
            output: {
              "count": { $sum: 1 },
              "titles": { $push: "$title" }
            }
          }  
        }
      ],
      "moviesByRuntime": [
        {
          $bucketAuto: {
            groupBy: "$runtime",
            buckets: 4,
            output: {
              "count": { $sum: 1 },
              "titles": { $push: "$title" }
            }
          }
        }
      ],
    
    }
  }
])


//*****************************************************************************************************************************
//*****************************************************************************************************************************


print("Pregunta 1")
pregunta1.forEach(function(doc){print(doc)})

print("Pregunta 2")
pregunta2.forEach(function(doc){print(doc)})

print("Pregunta 3")
pregunta3.forEach(function(doc){print(doc)})

print("Pregunta 4")
pregunta4.forEach(function(doc){print(doc)})

